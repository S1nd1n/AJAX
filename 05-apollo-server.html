<!doctype html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">

    <title>apollo-server</title>
</head>

<body>
    <div class="container">
        <div class="row">
            <h1>apollo-server</h1>
            <p class="lead">–ü—Ä–æ–µ–∫—Ç
                <a target="_blank" href="https://www.npmjs.com/package/apollo-server-express">apollo-server-express</a> - express-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è  <a target="_blank" href="https://www.apollographql.com/docs/apollo-server/">Apollo</a> —Å–µ—Ä–≤–µ—Ä–∞ 
            </p>


            <ol>
                <li>–°–æ–∑–¥–∞–π—Ç–µ –∏–ª–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –ø–∞–ø–∫—É node-apollo-server</li>
                <li>–ó–∞–ø—É—Å—Ç–∏—Ç–µ Win, –æ—Ç–∫—Ä–æ–π—Ç–µ cmd, —á–µ—Ä–µ–∑ cd –ø–µ—Ä–µ–π–¥–∏—Ç–µ –∫ —ç—Ç–æ–π –ø–∞–ø–∫–µ</li>
                <li>–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ npm init -y</li>
                <li>—É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä npm install apollo-server graphql</li>
                <li>—Å–æ–∑–¥–∞–π—Ç–µ —Ñ–∞–π–ª index.js —Å –¥–∞–Ω–Ω—ã–º–∏: <pre>const { ApolloServer, gql } = require('apollo-server');

// A schema is a collection of type definitions (hence "typeDefs")
// that together define the "shape" of queries that are executed against
// your data.
const typeDefs = gql`
  # Comments in GraphQL strings (such as this one) start with the hash (#) symbol.

  # This "Book" type defines the queryable fields for every book in our data source.
  type Book {
    title: String
    author: String
  }

  # The "Query" type is special: it lists all of the available queries that
  # clients can execute, along with the return type for each. In this
  # case, the "books" query returns an array of zero or more Books (defined above).
  type Query {
    books: [Book]
  }
`;

const books = [
  {
    title: 'The Awakening',
    author: 'Kate Chopin',
  },
  {
    title: 'City of Glass',
    author: 'Paul Auster',
  },
];

// Resolvers define the technique for fetching the types defined in the
// schema. This resolver retrieves books from the "books" array above.
const resolvers = {
  Query: {
    books: () => books,
  },
};

// The ApolloServer constructor requires two parameters: your schema
// definition and your set of resolvers.
const server = new ApolloServer({ typeDefs, resolvers });

// The `listen` method launches a web server.
server.listen().then(({ url }) => {
  console.log(`üöÄ  Server ready at ${url}`);
});
</pre></li>
                <li>–ó–∞–ø—É—Å—Ç–∏—Ç–µ —Å–µ—Ä–≤–µ—Ä: node index.js</li>
                <li>–£–±–µ–¥–∏—Ç–µ—Å—å —á—Ç–æ —Å–µ—Ä–≤–µ—Ä –∑–∞–ø—É—Å—Ç–∏–ª—Å—è - –æ—Ç–∫—Ä–æ–π—Ç–µ –≤ –±—Ä–∞—É–∑–µ—Ä–µ <a target="_blank" href="http://localhost:4000/">—Å—Ç—Ä–∞–Ω–∏—Ü—É</a></li>
                <li>–ó–∞–π–¥–∏—Ç–µ –≤ –ø–µ—Å–æ—á–Ω–∏—Ü—É –∑–∞–ø—Ä–æ—Å–æ–≤ https://studio.apollographql.com/sandbox/</li>
                <li>–í—Å—Ç–∞–≤—å—Ç–µ –∑–∞–ø—Ä–æ—Å query GetBooks {
  books {
    title
    author
  }
}</li>
<li>–ù–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É GetBooks –∏ —É–±–µ–¥–∏—Ç–µ—Å—å, —á—Ç–æ –¥–∞–Ω–Ω—ã–µ –ø—Ä–∏—à–ª–∏</li>
<li>–ù–∞–ø–∏—à–∏—Ç–µ –∫–æ–¥ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –∫–Ω–∏–≥ —á–µ—Ä–µ–∑ fetch –∑–∞–ø—Ä–æ—Å</li>
            </ol>
        </div>

        <hr />

        
        <section>
            <h3>Fetch</h3>

            <div class="row">
                <div class="col-md-6">
                    <h4>POST-–∑–∞–ø—Ä–æ—Å</h4>
                    <a href="#" class="btn btn-primary" onclick="books(); return false">–ü–æ–ª—É—á–∏—Ç—å –∫–Ω–∏–≥–∏</a>
                    <a href="#" class="btn btn-primary" onclick="addBook(); return false">–°–æ–∑–¥–∞—Ç—å –∫–Ω–∏–≥—É</a>
                    <a href="#" class="btn btn-primary" onclick="deleteBook(); return false">–£–¥–∞–ª–∏—Ç—å –∫–Ω–∏–≥—É(–∏)</a>
                    <a href="#" class="btn btn-primary" onclick="searchBooks('–ù–æ–≤–∞—è –∫–Ω–∏–≥–∞'); return false">–ù–∞–π—Ç–∏</a>
                   
                    <hr>
                </div>
                <div class="col-md-6">
                    <h4>–†–µ–∑—É–ª—å—Ç–∞—Ç</h4>
                    <pre id="result1"></pre>
                </div>
            </div>

            <script>
               
                function books(id) {

                    fetch(`http://localhost:4000/`,{
                        method: 'POST',
                        body: JSON.stringify({query: `query GetBooks {
                        books {
                            title
                            author
                        }
                        }`}) , headers: {
                            'content-type': 'application/json' 
                        }
                    })
                        .then(response => {
                            response.json().then(json => {
                                result1.innerHTML = JSON.stringify(json, null, ' ');
                            });
                        }).catch(txt => {
                            console.log('–û—à–∏–±–∫–∞: ', txt)
                        });
                }



                function searchBooks(title) {

        fetch(`http://localhost:4000/`,{
            method: 'POST',
            body: JSON.stringify({query: `query SearchBooks {
            searchbooks(title: "${title}") {
                title
                author
            }
            }`}) , headers: {
                'content-type': 'application/json' 
            }
        })
            .then(response => {
                response.json().then(json => {
                    result1.innerHTML = JSON.stringify(json, null, ' ');
                });
            }).catch(txt => {
                console.log('–û—à–∏–±–∫–∞: ', txt)
            });
        }

                function addBook(){

                fetch(`http://localhost:4000/`,{
                    method: 'POST',
                    body: JSON.stringify({query: `mutation CreateBook {
                    addBook(title: "–ù–æ–≤–∞—è –∫–Ω–∏–≥–∞", author: "–ù–µ–∏–∑–≤–µ—Å—Ç–Ω—ã–π –∞–≤—Ç–æ—Ä") {
                        title
                        author
                    }
                }`}) , headers: {
                        'content-type': 'application/json' 
                    }
                })
                    .then(response => {
                        response.json().then(json => {
                            result1.innerHTML = JSON.stringify(json, null, ' ');
                        });
                    }).catch(txt => {
                        console.log('–û—à–∏–±–∫–∞: ', txt)
                    });
                }
                function deleteBook(){

                fetch(`http://localhost:4000/`,{
                    method: 'POST',
                    body: JSON.stringify({query: `mutation DeleteBook {
                    deleteBook(title: "–ù–æ–≤–∞—è –∫–Ω–∏–≥–∞") {
                        title
                    }
                }`}) , headers: {
                        'content-type': 'application/json' 
                    }
                })
                    .then(response => {
                        response.json().then(json => {
                            result1.innerHTML = JSON.stringify(json, null, ' ');
                        });
                    }).catch(txt => {
                        console.log('–û—à–∏–±–∫–∞: ', txt)
                    });
                }       
            </script>
        </section>
    </div>
    </div>




    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/js/bootstrap.bundle.min.js" integrity="sha384-/bQdsTh/da6pkI1MST/rWKFNjaCP5gBSY4sEBT38Q/9RBh9AH40zEOg7Hlq2THRZ" crossorigin="anonymous"></script>

</body>

</html>